<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>مهام Am Rewards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Tajawal&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, #a8e063, #56ab2f);
      margin: 0;
      padding: 20px;
      color: #fff;
      min-height: 100vh;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: rgba(0,0,0,0.3);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 2rem;
      font-weight: 700;
      text-shadow: 1px 1px 5px #000;
    }
    .task-list {
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(250px,1fr));
      gap: 20px;
    }
    .task {
      background: #2e7d32;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.3s ease;
    }
    .task:hover {
      transform: translateY(-5px);
    }
    .task h3 {
      margin: 0 0 10px 0;
      font-size: 1.3rem;
    }
    .task p {
      margin: 5px 0;
      font-size: 1rem;
    }
    .task button {
      margin-top: 15px;
      padding: 12px;
      font-size: 1rem;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      transition: background-color 0.3s ease;
      color: #fff;
    }
    .btn-execute {
      background-color: #43a047;
    }
    .btn-execute:hover {
      background-color: #388e3c;
    }
    .btn-done {
      background-color: #9e9e9e;
      cursor: default;
    }
    .status-bar {
      margin-top: 20px;
      font-size: 1.2rem;
      text-align: center;
      font-weight: 700;
      text-shadow: 0 0 3px #000;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>مهام Am Rewards</h1>
    <div class="status-bar">
      <span id="done-count">0</span> / <span id="total-count">0</span> مهام مكتملة
    </div>
    <div class="task-list" id="task-list"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBfOJPkWbmcJ6s29bDNysr-H0Kx-Js3Gy0",
      authDomain: "am--rewards.firebaseapp.com",
      projectId: "am--rewards",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const tasks = [
      { id: "shortlinks", type: "رابط مختصر", count: 100, points: 8, url: "shortlinks.html" },
      { id: "appinstall", type: "تثبيت تطبيقات", count: 50, points: 7, url: "appinstall.html" },
      { id: "surveys", type: "استبيانات ناجحة", count: 30, points: 5, url: "surveys.html" },
      { id: "youtube", type: "متابعة يوتيوب / TikTok", count: 10, points: 3, url: "youtube.html" },
      { id: "ai", type: "أدوات AI / ChatGPT", count: 10, points: 3, url: "ai.html" },
      { id: "games", type: "ألعاب سريعة", count: 10, points: 3, url: "games.html" },
      { id: "secretoffers", type: "عروض سرية / مفاجآت", count: 10, points: 3, url: "secretoffers.html" },
      { id: "gifts", type: "بطاقات وهدايا عشوائية", count: 10, points: 3, url: "gifts.html" },
      { id: "webexplore", type: "استكشاف مواقع / نقرات", count: 10, points: 3, url: "webexplore.html" },
      { id: "shortsurveys", type: "استطلاعات قصيرة", count: 10, points: 4, url: "shortsurveys.html" },
    ];

    let user = null;
    let userTasks = {};

    const taskListEl = document.getElementById("task-list");
    const doneCountEl = document.getElementById("done-count");
    const totalCountEl = document.getElementById("total-count");

    totalCountEl.textContent = tasks.length;

    function renderTasks() {
      taskListEl.innerHTML = "";
      let doneCount = 0;

      tasks.forEach(task => {
        const done = userTasks[task.id] === true;
        if (done) doneCount++;

        const taskEl = document.createElement("div");
        taskEl.classList.add("task");

        // لون زر مختلف لكل مهمة حسب id (مثلاً بتدرج أخضر)
        let btnColor = "#43a047"; // أخضر
        switch(task.id) {
          case "shortlinks": btnColor = "#1b5e20"; break;
          case "appinstall": btnColor = "#2e7d32"; break;
          case "surveys": btnColor = "#66bb6a"; break;
          case "youtube": btnColor = "#a5d6a7"; break;
          case "ai": btnColor = "#81c784"; break;
          case "games": btnColor = "#388e3c"; break;
          case "secretoffers": btnColor = "#4caf50"; break;
          case "gifts": btnColor = "#9ccc65"; break;
          case "webexplore": btnColor = "#aed581"; break;
          case "shortsurveys": btnColor = "#c5e1a5"; break;
        }

        taskEl.innerHTML = `
          <h3>${task.type}</h3>
          <p>عدد المهام: ${task.count}</p>
          <p>النقاط لكل مهمة: ${task.points}</p>
          <button class="btn-execute" style="background-color: ${btnColor};" ${done ? "disabled class='btn-done'" : ""} id="btn-${task.id}">
            ${done ? "تم التنفيذ" : "تنفيذ المهمة"}
          </button>
        `;

        taskListEl.appendChild(taskEl);

        if (!done) {
          document.getElementById(`btn-${task.id}`).addEventListener("click", () => {
            executeTask(task.id, task.url);
          });
        }
      });

      doneCountEl.textContent = doneCount;
      totalCountEl.textContent = tasks.length;
    }

    async function executeTask(taskId, url) {
      window.open(url, "_blank");

      userTasks[taskId] = true;

      const docRef = doc(db, "userTasks", user.uid);
      await updateDoc(docRef, userTasks).catch(async () => {
        await setDoc(docRef, userTasks);
      });

      renderTasks();
    }

    onAuthStateChanged(auth, async (u) => {
      if (u) {
        user = u;
        const docRef = doc(db, "userTasks", user.uid);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          userTasks = docSnap.data();
        }
        renderTasks();
      } else {
        window.location.href = "login.html";
      }
    });
  </script>
</body>
</html>
