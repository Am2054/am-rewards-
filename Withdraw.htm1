<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>طلب السحب - Am Rewards</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-50 px-4 py-6">

  <div class="max-w-lg mx-auto bg-white p-6 rounded-xl shadow text-right">
    <h2 class="text-xl font-bold mb-4">💰 طلب السحب</h2>
    <p class="mb-2">رصيدك: <span id="userPoints" class="font-bold text-green-600">0</span> نقطة</p>
    <label>وسيلة الدفع:</label>
    <select id="method" class="w-full p-2 border rounded mt-1">
      <option value="vodafone">Vodafone Cash</option>
      <option value="paypal">PayPal</option>
    </select>
    <label class="mt-2 block">رقم الهاتف / الإيميل:</label>
    <input id="account" type="text" class="w-full p-2 border rounded mt-1">
    <button onclick="requestWithdraw()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded">طلب السحب</button>
  </div>

  <script>
    const firebaseConfig = {
      // 🔐 بيانات Firebase
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let userPoints = 0;

    auth.onAuthStateChanged(user => {
      if (user) {
        db.collection("users").doc(user.uid).get().then(doc => {
          userPoints = doc.data().points || 0;
          document.getElementById("userPoints").innerText = userPoints;
        });
      }
    });

    function requestWithdraw() {
      const method = document.getElementById("method").value;
      const account = document.getElementById("account").value;

      if (userPoints < 312.5) {
        alert("يجب أن تملك على الأقل 312.5 نقطة للسحب (25 EGP)");
        return;
      }

      auth.onAuthStateChanged(user => {
        if (user) {
          db.collection("withdrawals").add({
            uid: user.uid,
            method,
            account,
            date: new Date(),
            status: "pending",
            amount: userPoints
          }).then(() => {
            alert("تم إرسال طلب السحب ✅");
          });
        }
      });
    }
  </script>
</body>
</html>
